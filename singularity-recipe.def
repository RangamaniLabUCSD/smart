####### Notes #######
#
# This is a Singularity recipe that adds STUBS to a Docker container 
# with the current development version of FEniCS.
#
# Assuming you have Singularity already installed: to build an image from this recipe,
# use the following command (on a system where you have sudo access):
# $ sudo singularity build stubs.sif singularity-recipe.def
#
# If you do not have Singularity installed, follow the instructions at 
# https://sylabs.io/guides/latest/admin-guide/installation.html
#
# For convenience the instructions to install version 3.8.0 of Singularity on Linux
# are repeated here:
# $ sudo apt-get update && sudo apt-get install -y \
#   build-essential \
#   uuid-dev \
#   libgpgme-dev \
#   squashfs-tools \
#   libseccomp-dev \
#   wget \
#   pkg-config \
#   git \
#   cryptsetup-bin
# $ export VERSION=1.14.12 OS=linux ARCH=amd64 && \
#   wget https://dl.google.com/go/go$VERSION.$OS-$ARCH.tar.gz && \
#   sudo tar -C /usr/local -xzvf go$VERSION.$OS-$ARCH.tar.gz && \
#   rm go$VERSION.$OS-$ARCH.tar.gz
# $ echo 'export GOPATH=${HOME}/go' >> ~/.bashrc && \
#   echo 'export PATH=/usr/local/go/bin:${PATH}:${GOPATH}/bin' >> ~/.bashrc && \
#   source ~/.bashrc
# $ export SINGULARITY_VERSION=3.8.0 && # adjust this as necessary \
#   wget https://github.com/sylabs/singularity/releases/download/v${SINGULARITY_VERSION}/singularity-ce-${SINGULARITY_VERSION}.tar.gz && \
#   tar -xzf singularity-ce-${SINGULARITY_VERSION}.tar.gz && \
#   cd singularity-ce-${SINGULARITY_VERSION}
# $ git clone https://github.com/sylabs/singularity.git && \
#   cd SingularityCE && \
#   git checkout v${SINGULARITY_VERSION}
# $ ./mconfig && \
#   make -C ./builddir && \
#   sudo make -C ./builddir install
#
#####################

Bootstrap: docker
From: quay.io/fenicsproject/dev

%post
    # misc tools
    apt-get -qq update
    package_list="curl vim htop bpython"
    apt-get -qq -y install $package_list
    # useful python packages
    pip3 install meshio
    pip3 install gmsh
    pip3 install bpython
    # install stubs
    pip3 install fenics-stubs

%runscript
    echo "Welcome to the STUBS Singularity container"
    exec /bin/bash -i "$@"
#%environment
#    source ~/.bashrc
